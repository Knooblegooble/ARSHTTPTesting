<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - City Minute</title>
    <meta name="description" content="Get your City info wrapped up into a podcast format">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&amp;display=swap">
    <link rel="stylesheet" href="assets/css/3D-animated-text-on-hover-3D-animated-text-on-hover-1.css">
    <link rel="stylesheet" href="assets/css/3D-animated-text-on-hover.css">
    <link rel="stylesheet" href="assets/css/Animated-Type-Heading-BS5.css">
</head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="56" style="background: rgb(75,0,0);">
    <h2 class="display-5 fw-bold text-center text-white mb-4" style="margin: 33px;">City Minute Endpoint Testing</h2>
    <main>
        <section style="background: rgba(0,0,0,0.51);margin: 16px;"><!-- Latest Post Fetcher -->
<div class="mb-4">
  <button id="fetchLatestBtn" class="btn btn-info">
    <i class="bi bi-newspaper"></i>
    Fetch Latest Team Post
  </button>
</div>
<pre id="latestPost" class="border rounded p-3" style="background:#f8f9fa; max-height:300px; overflow:auto;">
  <!-- results will appear here -->
</pre>

<script>
  const apiBase = 'https://arstesting.onrender.com';

  document.getElementById('fetchLatestBtn').addEventListener('click', async () => {
    const out = document.getElementById('latestPost');
    out.textContent = 'Loading…';

    try {
      const res = await fetch(`${apiBase}/stlcitysc/latest-post`);
      if (!res.ok) throw new Error(`Server responded ${res.status}`);
      const data = await res.json();
      out.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
      console.error(err);
      out.textContent = `Error loading latest post:\n${err.message}`;
    }
  });
</script>
</section>
        <section><!-- Start: Audio Files Manager Section -->
<section id="audio-section" class="py-5 gradient-bg text-center position-relative overflow-hidden">
  <div class="container">
    <h2 class="display-5 fw-bold text-white mb-4">Your Podcast Audio Files</h2>

    <!-- Upload MP3 Field -->
    <div class="input-group mb-3 shadow">
      <input type="file" id="fileInput" class="form-control" accept=".mp3" aria-label="Choose MP3 to upload">
      <button id="uploadBtn" class="btn btn-success fw-semibold">
        <i class="bi bi-upload"></i>&nbsp;Upload
      </button>
    </div>

    <!-- List of Uploaded Files -->
    <ul id="fileList" class="list-group mb-4 shadow-sm text-start"></ul>

    <!-- Audio Player -->
    <audio id="audioPlayer" class="mt-3 w-100" controls hidden></audio>
  </div>
</section>

<!-- Bootstrap Icons (if not already loaded) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
  /* Reuse the same gradient + cube overlay */
  .gradient-bg {
    background: linear-gradient(135deg, #ff2c63 0%, #ff1e5a 25%, #c02c8f 50%, #8030bb 75%, #4045f4 100%);
  }
  .gradient-bg::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='80' height='92' viewBox='0 0 80 92' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23ffffff' stroke-opacity='0.1' stroke-width='1'%3E%3Cpath d='M40 0l40 23v46L40 92 0 69V23z'/%3E%3Cpath d='M0 23l40 23 40-23'/%3E%3Cpath d='M40 92V69'/%3E%3Cpath d='M80 69L40 46 0 69'/%3E%3Cpath d='M80 23L40 46 0 23'/%3E%3C/g%3E%3C/svg%3E");
    background-size: 120px auto;
    pointer-events: none;
  }
  #fileList .list-group-item {
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>

<script>
  const apiBase = ''; // leave empty for same-origin, or set to your API URL

  // Fetch and render the list of files
  async function refreshFileList() {
    const listEl = document.getElementById('fileList');
    listEl.innerHTML = '<li class="list-group-item">Loading...</li>';

    try {
      const res = await fetch(`${apiBase}/audio-files`);
      const files = await res.json();

      if (!Array.isArray(files) || files.length === 0) {
        listEl.innerHTML = '<li class="list-group-item">No files uploaded yet.</li>';
        return;
      }

      listEl.innerHTML = files.map(f => `
        <li class="list-group-item">
          <span>${f.fileName}</span>
          <div>
            <button class="btn btn-sm btn-primary me-2" data-play="${f.fileName}">
              <i class="bi bi-play-fill"></i>
            </button>
            <button class="btn btn-sm btn-danger" data-delete="${f.fileName}">
              <i class="bi bi-trash-fill"></i>
            </button>
          </div>
        </li>
      `).join('');
    } catch (err) {
      listEl.innerHTML = `<li class="list-group-item text-danger">Error loading files</li>`;
      console.error(err);
    }
  }

  // Handle upload
  document.getElementById('uploadBtn').addEventListener('click', async () => {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
      alert('Please select an MP3 to upload.');
      return;
    }

    const file = fileInput.files[0];
    if (file.type !== 'audio/mpeg') {
      alert('Only MP3 files are allowed.');
      return;
    }

    const form = new FormData();
    form.append('file', file);

    try {
      const res = await fetch(`${apiBase}/audio-files`, {
        method: 'POST',
        body: form
      });
      if (!res.ok) throw new Error(`Upload failed: ${res.status}`);
      await refreshFileList();
      fileInput.value = '';
    } catch (err) {
      console.error(err);
      alert(err.message);
    }
  });

  // Delegate play and delete buttons
  document.getElementById('fileList').addEventListener('click', async e => {
    const playFile = e.target.closest('[data-play]')?.dataset.play;
    const deleteFile = e.target.closest('[data-delete]')?.dataset.delete;

    if (playFile) {
      const player = document.getElementById('audioPlayer');
      player.src = `${apiBase}/audio-files/${encodeURIComponent(playFile)}`;
      player.hidden = false;
      await player.play();
    }

    if (deleteFile && confirm(`Delete "${deleteFile}"?`)) {
      try {
        const res = await fetch(`${apiBase}/audio-files/${encodeURIComponent(deleteFile)}`, {
          method: 'DELETE'
        });
        if (!res.ok) throw new Error(`Delete failed: ${res.status}`);
        await refreshFileList();
        document.getElementById('audioPlayer').hidden = true;
      } catch (err) {
        console.error(err);
        alert(err.message);
      }
    }
  });

  // Initial load
  document.addEventListener('DOMContentLoaded', refreshFileList);
</script>
<!-- End: Audio Files Manager Section -->
</section>
    </main>
    <section class="bg-primary contact" id="contact">
        <div class="container">
            <h2>Testing website for ARS endpoints:<br><code style="font-size: 28.75px;">GET&nbsp;&nbsp;https://arstesting.onrender.com/audio-files<br>POST&nbsp; https://arstesting.onrender.com/audio-files&nbsp; (form-field “file”)<br>GET&nbsp;&nbsp;https://arstesting.onrender.com/audio-files/:fileName<br>DELETE https://arstesting.onrender.com/audio-files/:fileName</code><br></h2>
        </div>
    </section>
    <footer>
        <div class="container">
            <p>©&nbsp;City Minute 2025. All Rights Reserved.</p>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Privacy</a></li>
                <li class="list-inline-item"><a href="#">Terms</a></li>
                <li class="list-inline-item"><a href="#">FAQ</a></li>
            </ul>
        </div>
    </footer>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/3D-animated-text-on-hover.js"></script>
    <script src="assets/js/Animated-Type-Heading-BS5-Animated-Type-Heading.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/latest-post.js"></script>
    <script src="assets/js/new-age.js"></script>
</body>

</html>
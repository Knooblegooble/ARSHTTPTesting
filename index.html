<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - City Minute</title>
    <meta name="description" content="Get your City info wrapped up into a podcast format">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&amp;display=swap">
    <link rel="stylesheet" href="assets/css/3D-animated-text-on-hover-3D-animated-text-on-hover-1.css">
    <link rel="stylesheet" href="assets/css/3D-animated-text-on-hover.css">
    <link rel="stylesheet" href="assets/css/Animated-Type-Heading-BS5.css">
</head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="56">
    <header class="masthead" style="background: url('assets/img/bg-pattern.png'), linear-gradient(to left, #7b4397, #dc2430);margin-bottom: -538px;">
        <h1 style="color: var(--bs-danger);background: var(--bs-focus-ring-color);height: 530px;margin-top: -485px;">City Minute</h1>
    </header>
    <main style="background: url(&quot;assets/img/bg-pattern.png&quot;), linear-gradient(to left, #7b4397, #dc2430);">
        <div class="container" style="margin-bottom: 191px;">
            <section class="text-center py-5 gradient-bg position-relative overflow-hidden" id="audio-section">
                <div class="container">
                    <h2 class="display-5 fw-bold text-white mb-4">Your Podcast Audio Files</h2>
                    <div class="input-group shadow mb-3"><input class="form-control form-control" type="file" accept=".mp3" aria-label="Choose MP3 to upload" id="fileInput"><button class="btn btn-success fw-semibold" id="uploadBtn"><i class="bi bi-upload"></i>&nbsp;Upload </button></div>
                    <ul class="list-group text-start shadow-sm mb-4" id="fileList"></ul><audio id="audioPlayer" class="mt-3 w-100" controls="" hidden=""></audio>
                </div>
            </section><script>
  const apiBase = 'https://arstesting.onrender.com'; // leave empty for same-origin, or set to your API URL

  // Fetch and render the list of files
  async function refreshFileList() {
    const listEl = document.getElementById('fileList');
    listEl.innerHTML = '<li class="list-group-item">Loading...</li>';

    try {
      const res = await fetch(`${apiBase}/audio-files`);
      const files = await res.json();

      if (!Array.isArray(files) || files.length === 0) {
        listEl.innerHTML = '<li class="list-group-item">No files uploaded yet.</li>';
        return;
      }

      listEl.innerHTML = files.map(f => `
        <li class="list-group-item">
          <span>${f.fileName}</span>
          <div>
            <button class="btn btn-sm btn-primary me-2" data-play="${f.fileName}">
              <i class="bi bi-play-fill"></i>
            </button>
            <button class="btn btn-sm btn-danger" data-delete="${f.fileName}">
              <i class="bi bi-trash-fill"></i>
            </button>
          </div>
        </li>
      `).join('');
    } catch (err) {
      listEl.innerHTML = `<li class="list-group-item text-danger">Error loading files</li>`;
      console.error(err);
    }
  }

  // Handle upload
  document.getElementById('uploadBtn').addEventListener('click', async () => {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
      alert('Please select an MP3 to upload.');
      return;
    }

    const file = fileInput.files[0];
    if (file.type !== 'audio/mpeg') {
      alert('Only MP3 files are allowed.');
      return;
    }

    const form = new FormData();
    form.append('file', file);

    try {
      const res = await fetch(`${apiBase}/audio-files`, {
        method: 'POST',
        body: form
      });
      if (!res.ok) throw new Error(`Upload failed: ${res.status}`);
      await refreshFileList();
      fileInput.value = '';
    } catch (err) {
      console.error(err);
      alert(err.message);
    }
  });

  // Delegate play and delete buttons
  document.getElementById('fileList').addEventListener('click', async e => {
    const playFile = e.target.closest('[data-play]')?.dataset.play;
    const deleteFile = e.target.closest('[data-delete]')?.dataset.delete;

    if (playFile) {
      const player = document.getElementById('audioPlayer');
      player.src = `${apiBase}/audio-files/${encodeURIComponent(playFile)}`;
      player.hidden = false;
      await player.play();
    }

    if (deleteFile && confirm(`Delete "${deleteFile}"?`)) {
      try {
        const res = await fetch(`${apiBase}/audio-files/${encodeURIComponent(deleteFile)}`, {
          method: 'DELETE'
        });
        if (!res.ok) throw new Error(`Delete failed: ${res.status}`);
        await refreshFileList();
        document.getElementById('audioPlayer').hidden = true;
      } catch (err) {
        console.error(err);
        alert(err.message);
      }
    }
  });

  // Initial load
  document.addEventListener('DOMContentLoaded', refreshFileList);
</script>
        </div>
    </main>
    <section class="bg-primary contact" id="contact">
        <div class="container">
            <h2>Testing website for ARS endpoints:<br><code style="font-size: 28.75px;">GET&nbsp;&nbsp;https://arstesting.onrender.com/audio-files<br>POST&nbsp; https://arstesting.onrender.com/audio-files&nbsp; (form-field “file”)<br>GET&nbsp;&nbsp;https://arstesting.onrender.com/audio-files/:fileName<br>DELETE https://arstesting.onrender.com/audio-files/:fileName</code><br></h2>
        </div>
    </section>
    <footer>
        <div class="container">
            <p>©&nbsp;City Minute 2025. All Rights Reserved.</p>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Privacy</a></li>
                <li class="list-inline-item"><a href="#">Terms</a></li>
                <li class="list-inline-item"><a href="#">FAQ</a></li>
            </ul>
        </div>
    </footer>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/3D-animated-text-on-hover.js"></script>
    <script src="assets/js/Animated-Type-Heading-BS5-Animated-Type-Heading.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/new-age.js"></script>
</body>

</html>